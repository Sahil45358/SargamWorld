<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SurSargam ‚Äì Harmonium</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f3eee8;
      color: #333;
      text-align: center;
  padding: 0;
    }

    header, footer {
      background: #240b36;
      color: white;
      padding: 1rem;
    }

    #harmonium {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      margin: 2rem auto;
      padding: 10px;
      width: calc(21 * 50px);
      height: 220px;
     background-image: url('wood.jpg');
      background-size: cover;
      
      border: 5px solid #3e1f0d;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      border-radius: 8px;
    }

    .white-key {
      width: 50px;
      height: 200px;
      border: 1px solid #888;
      background: #fffef5;
      box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 1;
      user-select: none;
      cursor: pointer;
    }

    .white-key.active {
      background: #ffd;
    }

    .white-key .label {
      position: absolute;
      bottom: 5px;
      width: 100%;
      font-size: 12px;
      font-weight: bold;
      color: #333;
    }

    .black-key {
      width: 30px;
      height: 120px;
      background: black;
      position: absolute;
      z-index: 2;
      top: 0;
      cursor: pointer;
      border-radius: 0 0 4px 4px;
      box-shadow: inset 0 -4px 10px rgba(255,255,255,0.1);
    }

    .black-key.active {
      background: #444;
    }

    #noteDisplay {
      margin-top: 1rem;
      font-weight: bold;
    }

    a {
      color: white;
      text-decoration: underline;
    }

#keyboard {
  width: 100%;
  max-width: 1000px;
  margin: auto;
  position: relative;
  touch-action: none;
}

.key.white {
  width: calc(100% / 21); /* Adjust based on total white keys */
  height: 160px;
}

.key.black {
  width: calc(100% / 35);
  height: 100px;
}

#scaleRaagSelector {
  text-align: center;
  margin-top: 1rem;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropbtn {
  background-color: #240b36;
  color: white;
  padding: 10px 18px;
  font-size: 16px;
  border: none;
  cursor: pointer;
  border-radius: 8px;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #fff;
  min-width: 200px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  z-index: 3;
  padding: 1rem;
  border-radius: 10px;
  text-align: left;
}

.dropdown-content {
  display: none;
}

.dropdown-content.show {
  display: block;
}

.sub-options {
  display: none;
  margin-top: 0.5rem;
}

.sub-options.show {
  display: block;
}

.sub-dropdown span {
  font-weight: bold;
  display: block;
  margin-bottom: 0.5rem;
}

.sub-options button {
  display: block;
  margin: 4px 0;
  width: 100%;
  background: #eee;
  border: none;
  padding: 6px;
  border-radius: 5px;
  text-align: left;
  cursor: pointer;
}

.sub-options button:hover {
  background: #d0d0f0;
}

/* Replace the old highlight class */
.highlight {
  background-color: #ffcc80 !important; /* light orange */
  border-color: #ffb74d !important;
  box-shadow: 0 0 10px #ffb74d;
}


    
  </style>
</head>
<body>
  <header>
    <h1>üéπ SurSargam ‚Äì Harmonium</h1>
    <p>Click and hold the keys to play (C2‚ÄìB4)</p>
  </header>

<div id="scaleRaagSelector">
  <div class="dropdown">
    <button class="dropbtn">üéπ Select Scale/Raag ‚ñº</button>
    <div class="dropdown-content">
      <div class="sub-dropdown">
  <span onclick="toggleSubOptions('scales')">üéº Scales ‚ñ∏</span>
  <div class="sub-options" id="scales-options">
          <button onclick="highlightScale('C Major')">C Major</button>
          <button onclick="highlightScale('C# Major')">C# Major</button>
          <button onclick="highlightScale('D Major')">D Major</button>
          <button onclick="highlightScale('D# Major')">D# Major</button>
          <button onclick="highlightScale('E Major')">E Major</button>
          <button onclick="highlightScale('F Major')">F Major</button>
          <button onclick="highlightScale('F# Major')">F# Major</button>
          <button onclick="highlightScale('G Major')">G Major</button>
          <button onclick="highlightScale('G# Major')">G# Major</button>
          <button onclick="highlightScale('A Major')">A Major</button>
          <button onclick="highlightScale('A# Major')">A# Major</button>
          <button onclick="highlightScale('B Major')">B Major</button>
        </div>
      </div>
      <div class="sub-dropdown">
  <span onclick="toggleSubOptions('raags')">üé∂ Raags ‚ñ∏</span>
  <div class="sub-options" id="raags-options">
          <button onclick="highlightRaag('Yaman')">Raag Yaman</button>
          <button onclick="highlightRaag('Bhairav')">Raag Bhairav</button>
          <button onclick="highlightRaag('Bhairavi')">Raag Bhairavi</button>
    <button onclick="highlightRaag('Desh')">Raag Desh</button>
<button onclick="highlightRaag('Kafi')">Raag Kafi</button>
<button onclick="highlightRaag('Durga')">Raag Durga</button>
<button onclick="highlightRaag('Bageshree')">Raag Bageshree</button>
<button onclick="highlightRaag('Khamaj')">Raag Khamaj</button>
          <!-- Add more raags here -->
        </div>
      </div>
    </div>
  </div>
</div>

  <div id="raag-info" style="text-align:center; font-size:18px; margin:10px 0;"></div>

  <div id="noteDisplay">Press a key‚Ä¶</div>
  
 <div id="harmonium"></div>
  <p><a href="index.html">‚¨ÖÔ∏è Back to Home</a></p>

  <footer>SurSargam ‚Ä¢ Harmonium Simulator with Wood Texture & Sustain</footer>

  
 <script>
  let isMouseDown = false;
let currentNoteId = null;
   const audioBuffers = {};
const activeNodes = {};
   
  const ctx = new (window.AudioContext || window.webkitAudioContext)();

  const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
  const blackMap = { C: true, D: true, F: true, G: true, A: true };
  const semitones = {
    'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4,
    'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
  };
  const baseFreq = 65.41; // Frequency of C2

const container = document.getElementById('harmonium');
   
  const noteDisplay = document.getElementById('noteDisplay');
  let activeNotes = {};

  function freqOf(note) {
    const [pitch, oct] = note.match(/([A-G]#?)(\d)/).slice(1);
    return baseFreq * Math.pow(2, (semitones[pitch] + (oct - 2) * 12) / 12);
  }

function playNote(note, keyDiv) {
  if (!audioBuffers[note]) return;

  if (isMouseDown) {
    document.querySelectorAll('.white-key.active, .black-key.active').forEach(key => {
      const activeNote = key.dataset.note;
      if (activeNote !== note) stopNote(activeNote, key);
    });
  }

  const source = ctx.createBufferSource();
  source.buffer = audioBuffers[note];
  source.connect(ctx.destination);
  source.loop = true;
  source.start();

  activeNodes[note] = source;
  keyDiv.classList.add('active');
  noteDisplay.innerText = note;
}

function stopNote(note, keyDiv) {
  const source = activeNodes[note];
  if (source) {
    source.stop();
    delete activeNodes[note];
  }
  keyDiv.classList.remove('active');
}

  document.body.addEventListener('mousedown', () => isMouseDown = true);
  document.body.addEventListener('mouseup', () => {
    isMouseDown = false;
    // Stop all notes on mouse release
    document.querySelectorAll('.white-key.active, .black-key.active').forEach(key => {
      const note = key.dataset.note;
      stopNote(note, key);
    });
  });

  function makeKey(note, isBlack) {
    const key = document.createElement('div');
    key.className = isBlack ? 'black-key' : 'white-key';
    key.dataset.note = note;

    if (!isBlack && note.startsWith('C')) {
      const label = document.createElement('div');
      label.className = 'label';
      label.innerText = note;
      key.appendChild(label);
    }

    // Desktop events
key.addEventListener('mousedown', () => playNote(note, key));
key.addEventListener('mouseenter', () => {
  if (isMouseDown) playNote(note, key);
});
key.addEventListener('mouseup', () => stopNote(note, key));
key.addEventListener('mouseleave', () => {
  if (!isMouseDown) stopNote(note, key);
});

// Mobile events
key.addEventListener("touchstart", (e) => {
  e.preventDefault();
  playNote(note, key);
  isMouseDown = true;
}, { passive: false });

key.addEventListener("touchend", (e) => {
  e.preventDefault();
  stopNote(note, key);
  isMouseDown = false;
}, { passive: false });
    return key;
  }

// White keys
for (let oct = 2; oct <= 4; oct++) {
  whiteKeys.forEach((pitch, i) => {
    const note = pitch + oct;
    const whiteKey = makeKey(note, false);
    whiteKey.style.position = 'relative';
    container.appendChild(whiteKey);

// Black keys
if (blackMap[pitch]) {
      const blackNote = pitch + '#' + oct;
      const blackKey = makeKey(blackNote, true);
      const index = ((oct - 2) * 7 + i);
      blackKey.style.position = 'absolute';
      blackKey.style.left = `${index * 50 + 35}px`;
      container.appendChild(blackKey);
    }
  });
  }
   // wav
   async function loadSamples() {
  const notes = [];
  const octaves = [2, 3, 4];
  const keys = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];

  octaves.forEach(oct => {
    keys.forEach(note => notes.push(`${note}${oct}`));
  });

  await Promise.all(notes.map(async (note) => {
    const response = await fetch(`harmonium/${encodeURIComponent(note)}.wav`);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
    audioBuffers[note] = audioBuffer;
  }));
}
   loadSamples();
function resumeAudioContext() {
  if (ctx.state === 'suspended') {
    ctx.resume();
  }
}
document.body.addEventListener('touchstart', resumeAudioContext, { once: true });
document.body.addEventListener('click', resumeAudioContext, { once: true });
 

const scaleMap = {
  "C Major": ['C', 'D', 'E', 'F', 'G', 'A', 'B'],
  "C# Major": ['C#', 'D#', 'F', 'F#', 'G#', 'A#', 'C'],
  "D Major": ['D', 'E', 'F#', 'G', 'A', 'B', 'C#'],
  "D# Major": ['D#', 'F', 'G', 'G#', 'A#', 'C', 'D'],
  "E Major": ['E', 'F#', 'G#', 'A', 'B', 'C#', 'D#'],
  "F Major": ['F', 'G', 'A', 'A#', 'C', 'D', 'E'],
  "F# Major": ['F#', 'G#', 'A#', 'B', 'C#', 'D#', 'F'],
  "G Major": ['G', 'A', 'B', 'C', 'D', 'E', 'F#'],
  "G# Major": ['G#', 'A#', 'C', 'C#', 'D#', 'F', 'G'],
  "A Major": ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#'],
  "A# Major": ['A#', 'C', 'D', 'D#', 'F', 'G', 'A'],
  "B Major": ['B', 'C#', 'D#', 'E', 'F#', 'G#', 'A#']
};

const raagMap = {
  "Yaman": {
    notes: ['C#', 'D#', 'F#', 'G', 'A', 'B'],
    aaroh: "N R G M^ D N S'",
    avroh: "S' N D P M^ G R S"
  },
  "Bhairav": {
    notes: ['C', 'Db', 'E', 'F', 'G', 'Ab', 'B'],
    aaroh: "S r G M P d N S'",
    avroh: "S' N d P M G r S"
  },
  "Bhairavi": {
    notes: ['C', 'D', 'Eb', 'F', 'G', 'Ab', 'Bb'],
    aaroh: "S R g M P d n S'",
    avroh: "S' n d P M g R S"
  },
  "Desh": {
    notes: ['C', 'D', 'F', 'G', 'A', 'Bb'],
    aaroh: "N R M P N S'",
    avroh: "S' n D P M G R S"
  },
  "Kafi": {
    notes: ['C', 'D', 'Eb', 'F', 'G', 'A', 'Bb'],
    aaroh: "S R g M P D n S'",
    avroh: "S' n D P M g R S"
  },
  "Durga": {
    notes: ['C', 'D', 'F', 'G', 'A'],
    aaroh: "S R M P D S'",
    avroh: "S' D P M R S"
  },
  "Bageshree": {
    notes: ['C', 'D', 'Eb', 'F', 'G', 'A', 'Bb'],
    aaroh: "S g M D n S'",
    avroh: "S' n D M g R S"
  },
  "Khamaj": {
    notes: ['C', 'D', 'E', 'F', 'G', 'A', 'Bb'],
    aaroh: "S G M P D N S'",
    avroh: "S' n D P M G R S"
  }
};

   
function clearHighlights() {
  document.querySelectorAll('.white-key, .black-key').forEach(key => key.classList.remove('highlight'));
}

function highlightScale(name) {
  clearHighlights();
  const pitches = scaleMap[name];
  for (let oct = 2; oct <= 4; oct++) {
    pitches.forEach(p => {
      let note = p.replace('##', '#'); // Simplify double sharps
      note = note.replace('E#', 'F').replace('B#', 'C');
      const full = `${note}${oct}`;
      const key = document.querySelector(`[data-note="${full}"]`);
      if (key) key.classList.add('highlight');
    });
  }
}

function highlightRaag(name) {
  clearHighlights();
  const pitches = raagMap[name];
  for (let oct = 2; oct <= 4; oct++) {
    pitches.forEach(p => {
      const pitch = p.replace('b', '#'); // For flat notations
      const full = `${pitch}${oct}`;
      const key = document.querySelector(`[data-note="${full}"]`);
      if (key) key.classList.add('highlight');
    });
  }
}
    // Display Aaroh and Avroh
  const infoDiv = document.getElementById('raag-info');
  infoDiv.innerHTML = `
    <strong>${name}</strong><br>
    <span style="color:green;"><b>Aaroh:</b></span> ${raag.aaroh}<br>
    <span style="color:blue;"><b>Avroh:</b></span> ${raag.avroh}
  `;
}
   
// Toggle sub-options for Scales and Raags
function toggleSubOptions(type) {
  const scaleList = document.getElementById('scales-options');
  const raagList = document.getElementById('raags-options');

  if (type === 'scales') {
    scaleList.classList.toggle('show');
    raagList.classList.remove('show');
  } else if (type === 'raags') {
    raagList.classList.toggle('show');
    scaleList.classList.remove('show');
  }
}
// Toggle dropdown main menu
document.querySelector('.dropbtn').addEventListener('click', function () {
  document.querySelector('.dropdown-content').classList.toggle('show');
});

   // Close dropdown when clicking outside
window.addEventListener('click', function (e) {
  const dropdown = document.querySelector('.dropdown');
  if (!dropdown.contains(e.target)) {
    document.querySelector('.dropdown-content').classList.remove('show');
    document.getElementById('scales-options').classList.remove('show');
    document.getElementById('raags-options').classList.remove('show');
  }
});


   
</script>
</body>
</html>

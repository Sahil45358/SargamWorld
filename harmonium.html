<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SurSargam ‚Äì Harmonium</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f3eee8;
      color: #333;
      text-align: center;
  padding: 0;
    }

    header, footer {
      background: #240b36;
      color: white;
      padding: 1rem;
    }

    #harmonium {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      margin: 2rem auto;
      padding: 10px;
      width: calc(21 * 50px);
      height: 220px;
     background-image: url('wood.jpg');
      background-size: cover;
      
      border: 5px solid #3e1f0d;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      border-radius: 8px;
    }

    .white-key {
      width: 50px;
      height: 200px;
      border: 1px solid #888;
      background: #fffef5;
      box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 1;
      user-select: none;
      cursor: pointer;
    }

    .white-key.active {
      background: #ffd;
    }

    .white-key .label {
      position: absolute;
      bottom: 5px;
      width: 100%;
      font-size: 12px;
      font-weight: bold;
      color: #333;
    }

    .black-key {
      width: 30px;
      height: 120px;
      background: black;
      position: absolute;
      z-index: 2;
      top: 0;
      cursor: pointer;
      border-radius: 0 0 4px 4px;
      box-shadow: inset 0 -4px 10px rgba(255,255,255,0.1);
    }

    .black-key.active {
      background: #444;
    }

    #noteDisplay {
      margin-top: 1rem;
      font-weight: bold;
    }

    a {
      color: white;
      text-decoration: underline;
    }

#keyboard {
  width: 100%;
  max-width: 1000px;
  margin: auto;
  position: relative;
  touch-action: none;
}

.key.white {
  width: calc(100% / 21); /* Adjust based on total white keys */
  height: 160px;
}

.key.black {
  width: calc(100% / 35);
  height: 100px;
}

    
  </style>
</head>
<body>
  <header>
    <h1>üéπ SurSargam ‚Äì Harmonium</h1>
    <p>Click and hold the keys to play (C2‚ÄìB4)</p>
  </header>

  <div id="noteDisplay">Press a key‚Ä¶</div>
  
 <div id="harmonium"></div>
  <p><a href="index.html">‚¨ÖÔ∏è Back to Home</a></p>

  <footer>SurSargam ‚Ä¢ Harmonium Simulator with Wood Texture & Sustain</footer>

  
 <script>
  let isMouseDown = false;
let currentNoteId = null;
   const audioBuffers = {};
const activeNodes = {};
   
  const ctx = new (window.AudioContext || window.webkitAudioContext)();

  const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
  const blackMap = { C: true, D: true, F: true, G: true, A: true };
  const semitones = {
    'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4,
    'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
  };
  const baseFreq = 65.41; // Frequency of C2

const container = document.getElementById('harmonium');
   
  const noteDisplay = document.getElementById('noteDisplay');
  let activeNotes = {};

  function freqOf(note) {
    const [pitch, oct] = note.match(/([A-G]#?)(\d)/).slice(1);
    return baseFreq * Math.pow(2, (semitones[pitch] + (oct - 2) * 12) / 12);
  }

function playNote(note, keyDiv) {
  if (!audioBuffers[note]) return;

  if (isMouseDown) {
    document.querySelectorAll('.white-key.active, .black-key.active').forEach(key => {
      const activeNote = key.dataset.note;
      if (activeNote !== note) stopNote(activeNote, key);
    });
  }

  const source = ctx.createBufferSource();
  source.buffer = audioBuffers[note];
  source.connect(ctx.destination);
  source.loop = true;
  source.start();

  activeNodes[note] = source;
  keyDiv.classList.add('active');
  noteDisplay.innerText = note;
}

function stopNote(note, keyDiv) {
  const source = activeNodes[note];
  if (source) {
    source.stop();
    delete activeNodes[note];
  }
  keyDiv.classList.remove('active');
}

  document.body.addEventListener('mousedown', () => isMouseDown = true);
  document.body.addEventListener('mouseup', () => {
    isMouseDown = false;
    // Stop all notes on mouse release
    document.querySelectorAll('.white-key.active, .black-key.active').forEach(key => {
      const note = key.dataset.note;
      stopNote(note, key);
    });
  });

  function makeKey(note, isBlack) {
    const key = document.createElement('div');
    key.className = isBlack ? 'black-key' : 'white-key';
    key.dataset.note = note;

    if (!isBlack && note.startsWith('C')) {
      const label = document.createElement('div');
      label.className = 'label';
      label.innerText = note;
      key.appendChild(label);
    }

    // Events for sound and dragging
    key.addEventListener('mousedown', () => playNote(note, key));
    key.addEventListener('mouseenter', () => {
      if (isMouseDown) playNote(note, key);
    });
    key.addEventListener('mouseup', () => stopNote(note, key));
    key.addEventListener('mouseleave', () => {
      if (!isMouseDown) stopNote(note, key);
    });

    return key;
  }

// White keys
for (let oct = 2; oct <= 4; oct++) {
  whiteKeys.forEach((pitch, i) => {
    const note = pitch + oct;
    const whiteKey = makeKey(note, false);
    whiteKey.style.position = 'relative';
    container.appendChild(whiteKey);

// Black keys
if (blackMap[pitch]) {
      const blackNote = pitch + '#' + oct;
      const blackKey = makeKey(blackNote, true);
      const index = ((oct - 2) * 7 + i);
      blackKey.style.position = 'absolute';
      blackKey.style.left = `${index * 50 + 35}px`;
      container.appendChild(blackKey);
    }
  });
  }
   // wav
   async function loadSamples() {
  const notes = [];
  const octaves = [2, 3, 4];
  const keys = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];

  octaves.forEach(oct => {
    keys.forEach(note => notes.push(`${note}${oct}`));
  });

  await Promise.all(notes.map(async (note) => {
    const response = await fetch(`harmonium/${encodeURIComponent(note)}.wav`);
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await ctx.decodeAudioData(arrayBuffer);
    audioBuffers[note] = audioBuffer;
  }));
}
   loadSamples();

 
   key.addEventListener("touchstart", (e) => {
  e.preventDefault();
  playNote(note);
  isMouseDown = true;
}, { passive: false });

key.addEventListener("touchend", (e) => {
  e.preventDefault();
  stopNote(note);
  isMouseDown = false;
}, { passive: false });

key.addEventListener("touchmove", (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const element = document.elementFromPoint(touch.clientX, touch.clientY);
  if (element && element.classList.contains("key") && isMouseDown) {
    const draggedNote = element.getAttribute("data-note");
    if (draggedNote !== currentNote) {
      stopNote(currentNote);
      playNote(draggedNote);
      currentNote = draggedNote;
    }
  }
}, { passive: false });

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SurSargam ‚Äì Harmonium</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f3eee8;
      color: #333;
      text-align: center;
    }

    header, footer {
      background: #240b36;
      color: white;
      padding: 1rem;
    }

    #harmonium {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      margin: 2rem auto;
      padding: 10px;
      width: calc(21 * 50px);
      height: 220px;
      background-image: url('https://i.imgur.com/raZ6yNC.jpg'); /* Seamless wood texture */
      background-size: cover;
      border: 5px solid #3e1f0d;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      border-radius: 8px;
    }

    .white-key {
      width: 50px;
      height: 200px;
      border: 1px solid #888;
      background: #fffef5;
      box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.2);
      position: relative;
      z-index: 1;
      user-select: none;
      cursor: pointer;
    }

    .white-key.active {
      background: #ffd;
    }

    .white-key .label {
      position: absolute;
      bottom: 5px;
      width: 100%;
      font-size: 12px;
      font-weight: bold;
      color: #333;
    }

    .black-key {
      width: 30px;
      height: 120px;
      background: black;
      position: absolute;
      z-index: 2;
      top: 0;
      cursor: pointer;
      border-radius: 0 0 4px 4px;
      box-shadow: inset 0 -4px 10px rgba(255,255,255,0.1);
    }

    .black-key.active {
      background: #444;
    }

    #noteDisplay {
      margin-top: 1rem;
      font-weight: bold;
    }

    a {
      color: white;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>üéπ SurSargam ‚Äì Harmonium</h1>
    <p>Click and hold the keys to play (C2‚ÄìB4)</p>
  </header>

  <div id="noteDisplay">Press a key‚Ä¶</div>
  <div id="harmonium"></div>

  <p><a href="index.html">‚¨ÖÔ∏è Back to Home</a></p>

  <footer>SurSargam ‚Ä¢ Harmonium Simulator with Wood Texture & Sustain</footer>

  
  <script>
    let isMouseDown = false;
    
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    const blackMap = { C: true, D: true, F: true, G: true, A: true };
    const semitones = { 'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11 };
    const baseFreq = 65.41; // Frequency of C2

    const container = document.getElementById('harmonium');
    const noteDisplay = document.getElementById('noteDisplay');

    let activeNotes = {};

    function freqOf(note) {
      const [pitch, oct] = note.match(/([A-G]#?)(\d)/).slice(1);
      return baseFreq * Math.pow(2, (semitones[pitch] + (oct - 2) * 12) / 12);
    }

    function playNote(note, keyDiv) {
      if (activeNotes[note]) return;

      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'triangle';
      osc.frequency.value = freqOf(note);
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.05);
      osc.start();

      activeNotes[note] = { osc, gain };

      keyDiv.classList.add('active');
      noteDisplay.innerText = note;
    }

    function stopNote(note, keyDiv) {
      if (!activeNotes[note]) return;
      const { osc, gain } = activeNotes[note];
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.3);
      osc.stop(ctx.currentTime + 0.35);
      delete activeNotes[note];

      keyDiv.classList.remove('active');
    }

    function makeKey(note, isBlack, position = 0) {
      const key = document.createElement('div');
      key.className = isBlack ? 'black-key' : 'white-key';
      key.dataset.note = note;

      if (!isBlack && note.startsWith('C')) {
        const label = document.createElement('div');
        label.className = 'label';
        label.innerText = note;
        key.appendChild(label);
      }

      let isMouseDown = false;
let currentOsc = null;
let currentGain = null;

// Listen for mouse down and up globally
document.body.addEventListener('mousedown', () => isMouseDown = true);
document.body.addEventListener('mouseup', () => {
  isMouseDown = false;
  stopNote();
});

// Start playing sound
function startNote(label, frequency) {
  display.textContent = 'üéµ ' + label;

  stopNote(); // stop any previous note first

  currentOsc = ctx.createOscillator();
  currentGain = ctx.createGain();

  currentOsc.type = 'sine';
  currentOsc.frequency.value = frequency;

  currentGain.gain.setValueAtTime(0.3, ctx.currentTime);
  currentOsc.connect(currentGain).connect(ctx.destination);

  currentOsc.start();
}

// Stop the currently playing note
function stopNote() {
  if (currentGain) {
    currentGain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);
    currentGain = null;
  }
  if (currentOsc) {
    currentOsc.stop(ctx.currentTime + 0.25);
    currentOsc = null;
  }
}

    // Build harmonium keys
    for (let oct = 2; oct <= 4; oct++) {
      whiteKeys.forEach((pitch, i) => {
        const note = pitch + oct;
        const whiteKey = makeKey(note, false);
        container.appendChild(whiteKey);
        
        key.addEventListener('mousedown', () => startNote(noteId, freq));
key.addEventListener('mouseenter', () => {
  if (isMouseDown) startNote(noteId, freq);
});
key.addEventListener('mouseup', stopNote);
key.addEventListener('mouseleave', () => {
  if (!isMouseDown) stopNote();
});

        // Black keys
        if (blackMap[pitch]) {
          const blackNote = pitch + '#' + oct;
          const blackKey = makeKey(blackNote, true);
          // Position black keys relative to white keys
          const index = ((oct - 2) * 7 + i);
          blackKey.style.left = `${index * 50 + 35}px`;
          container.appendChild(blackKey);

          black.addEventListener('mousedown', () => startNote(black.dataset.note, blackFreq));
black.addEventListener('mouseenter', () => {
  if (isMouseDown) startNote(black.dataset.note, blackFreq);
});
black.addEventListener('mouseup', stopNote);
black.addEventListener('mouseleave', () => {
  if (!isMouseDown) stopNote();
});
        }
      });
    }

      
   document.addEventListener('mousedown', () => isMouseDown = true);
document.addEventListener('mouseup', () => isMouseDown = false);
      document.querySelectorAll('.white-key.active, .black-key.active').forEach(key => {
        const note = key.dataset.note;
        stopNote(note, key);
      });
    });
  </script>
</body>
</html>

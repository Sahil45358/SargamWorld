<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SurSargam ‚Äì Harmonium</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: url('wood.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
    }

    header, footer {
      background: rgba(0, 0, 0, 0.6);
      padding: 1rem;
    }

    #harmonium-container {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }

    #harmonium {
      position: relative;
      display: flex;
      height: 200px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #5d4037;
      padding: 10px;
      box-shadow: 0 0 10px #000;
    }

    .white-key {
      width: 40px;
      height: 100%;
      background: #fff8e1;
      border: 1px solid #5d4037;
      margin-right: 1px;
      position: relative;
      z-index: 1;
      border-radius: 0 0 5px 5px;
      cursor: pointer;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
    }

    .white-key:active {
      background: #ffe082;
    }

    .black-key {
      width: 26px;
      height: 120px;
      background: #2b2b2b;
      position: absolute;
      top: 0;
      z-index: 2;
      border-radius: 0 0 4px 4px;
      cursor: pointer;
    }

    .black-key:active {
      background: #444;
    }

    #noteDisplay {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #ffccbc;
    }

    a {
      color: #ffe0b2;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>üéπ SurSargam ‚Äì Harmonium</h1>
    <p>Click and hold a key to play. Release to stop.</p>
  </header>

  <div id="noteDisplay">Click a key‚Ä¶</div>
  <div id="harmonium-container">
    <div id="harmonium"></div>
  </div>

  <p><a href="index.html">‚¨ÖÔ∏è Back to Home</a></p>

  <footer>
    <p>üé∂ SurSargam ‚Ä¢ Interactive Harmonium with C2‚ÄìC4 Octaves</p>
  </footer>

  <script>
    const harmonium = document.getElementById("harmonium");
    const display = document.getElementById("noteDisplay");
    const ctx = new (window.AudioContext || window.webkitAudioContext)();

    const whiteOrder = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    const blackOrder = ['C#', 'D#', '', 'F#', 'G#', 'A#', ''];

    const baseFreq = 65.41; // C2
    const semitoneSteps = {
      'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4,
      'F': 5, 'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
    };

    const keyRefs = {};

    for (let octave = 2; octave <= 4; octave++) {
      for (let i = 0; i < whiteOrder.length; i++) {
        const note = whiteOrder[i];
        const noteId = note + octave;

        const white = document.createElement("div");
        white.className = "white-key";
        if (note === 'C') white.innerText = noteId;
        white.dataset.note = noteId;
        harmonium.appendChild(white);

        addHandlers(white, noteId);

        keyRefs[noteId] = white;

        // Add black key if applicable
        const black = blackOrder[i];
        if (black !== "") {
          const blackId = black + octave;
          const blackDiv = document.createElement("div");
          blackDiv.className = "black-key";
          blackDiv.dataset.note = blackId;

          const position = harmonium.children.length - 1;
          blackDiv.style.left = `${position * 41 - 13}px`;

          harmonium.appendChild(blackDiv);
          addHandlers(blackDiv, blackId);
        }
      }
    }

    function addHandlers(key, label) {
      const frequency = getFrequency(label);
      key.onmousedown = () => startNote(label, frequency);
      key.onmouseup = stopNote;
      key.onmouseleave = stopNote;
      key.oncontextmenu = e => e.preventDefault();
    }

    function getFrequency(note) {
      const step = semitoneSteps[note.slice(0, -1)] + (parseInt(note.slice(-1)) - 2) * 12;
      return baseFreq * Math.pow(2, step / 12);
    }

    let osc = null;
    let gain = null;

    function startNote(label, frequency) {
      display.textContent = "üéµ " + label;
      osc = ctx.createOscillator();
      gain = ctx.createGain();

      osc.type = 'triangle'; // richer tone than sine
      osc.frequency.value = frequency;

      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.5, ctx.currentTime + 0.05);

      osc.connect(gain).connect(ctx.destination);
      osc.start();
    }

    function stopNote() {
      if (gain) gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.2);
      if (osc) osc.stop(ctx.currentTime + 0.25);
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bhatkhande Notation — SargamWorld</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <style>
    /* === THEME VARIABLES === */
    :root {
      --accent: #800000;      /* red theme */
      --bg: #f3eee8;
      --text: #222;
      --muted: #5a5a5a;
      --radius: 12px;
      --container-w: 1100px;
      --transition: 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      line-height: 1.6;
    }

    a { text-decoration: none; color: inherit; }

    /* === NAVBAR === */
    .site-header {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1000;
    }

    .nav-inner {
      max-width: var(--container-w);
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between; /* logo left, links right */
      gap: 12px;
      padding: 12px 20px;
      flex-wrap: wrap; /* allows wrapping on smaller screens */
    }

    .brand-wrap {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      flex-shrink: 0; /* prevent shrinking on PC */
    }

    .logo { display: flex; align-items: center; gap: 8px; font-weight:700; font-size:1.2rem; color:#fff; }
    .logo img { height: 120px; }

    .tagline {
      font-size: 0.8rem;
      font-weight: 400;
      color: #f3e8e8;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .nav-links {
      display: flex;
      gap: 10px;
      list-style: none;
      margin-left: auto; /* push links to the right */
    }

    .nav-links a {
      color:#fff; padding:8px 12px; border-radius:8px; font-weight:600; transition: var(--transition);
    }
    .nav-links a:hover, .nav-links a:focus { background: rgba(255,255,255,0.1); }
    .nav-links a.active { background: rgba(255,255,255,0.15); }

    .hamburger {
      display: none;
      cursor: pointer;
      font-size: 1.6rem;
      color: #fff;
    }

    @media (pointer: coarse) {
      .logo span { display: none !important; }
    }
    @media (max-width: 1024px) {
      .logo span { display: none !important; }
    }
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        flex-direction: column;
        background: var(--accent);
        position: absolute;
        top: 100px; right: 20px;
        padding: 15px;
        border-radius: 8px;
      }
      .nav-links.show { display: flex; }
      .hamburger { display: block; position: relative; z-index: 1100; }
      .tagline { font-size: 0.7rem; }
      .nav-links { margin-left: 0; }
    }

    /* === HERO === */
    .hero { text-align: center; margin-bottom: 30px; }
    .hero h1 { font-size: 2rem; color: var(--accent); margin-bottom: 10px; }
    .hero p { max-width: 720px; margin: 0 auto; color: var(--muted); line-height: 1.6; }


    
  /* Editor adjustments */
#editor {
  width: 80%;
  max-width: 720px;   /* ✅ limit maximum width on PC */
  min-width: 300px;   /* ✅ minimum width so it doesn't shrink too small on mobile */
  margin: 0 auto 20px auto; /* center the editor */
  min-height: 200px;  /* slightly smaller height */
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: var(--radius);
  padding: 12px;
  font-size: 1.1rem;   /* Optional: a bit smaller for more compactness */
  background: #fff;
  font-family: 'Segoe UI', sans-serif; /* default typing */
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow: auto;
  margin: 0 auto 20px;  /* center editor horizontally */
  scroll-behavior: smooth;
  direction: ltr;
  text-align: left;
  line-height: 1.3;    /* ✅ Much more compact and natural */
}


/* Optional: even smaller on very small screens */
@media (max-width: 480px) {
  #editor {
    font-size: 1rem;
    min-height: 150px;
  }
}
    /* === KEYBOARD BUTTONS === */
 .keyboard button {
  width: 60px;           /* same width */
  height: 40px;          /* same height */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px;          /* smaller padding to fit text */
  font-size: 0.75rem;    /* smaller font for longer labels */
  text-align: center;
  line-height: 1.1;
  word-wrap: break-word; /* allow breaking text into multiple lines */
  background: #800000;
  color: #fff;
  border: none;
  border-radius: 6px;
  margin: 3px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s ease;
}


    .keyboard button:hover {
      background: #9b1717;
      color: #fff;
    }
@media(min-width: 1025px) {
  .keyboard button {
    width: 70px;
    height: 45px;
    font-size: 0.8rem;
  }
}
    .keyboard-section button {
      background: #800000;
      color: #fff;
    }
    .keyboard-section button:hover {
      background: #9b1717;
    }

/* === Keyboard container & sections === */
.keyboard {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;               
  justify-content: center;  
  margin: 20px auto;       
}

.keyboard-section {
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: var(--radius);
  padding: 10px;
  background: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;   
  min-width: 180px;          
}

@media (max-width: 768px) {
  .keyboard-section {
    min-width: 140px;
    padding: 8px;
  }

  .keyboard button {
    padding: 6px 10px;
    font-size: 0.9rem;
  }

@media (max-width: 768px) {
  .keyboard button {
    width: 45px;
    height: 35px;
    font-size: 0.65rem;
  }
}
    
    /* === FOOTER === */
    .site-footer { text-align: center; padding: 20px; color: var(--muted); font-size: 0.9rem; margin-top: 40px; }

.notation-active {
  border: 2px solid var(--accent);
  background: #fffbe7;
}

  #fontSelector:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
 
  #editor span.ome-bhatkhande-hindi { font-family: 'ome_bhatkhande_hindi'; }
  #editor span.ome-bhatkhande-punjabi { font-family: 'ome_bhatkhande_punjabi'; }
  #editor span.ome-bhatkhande-bangla { font-family: 'ome_bhatkhande_bangla'; }
  #editor span.ome-bhatkhande-english { font-family: 'ome_bhatkhande_english'; }
  #editor span.ome-swarlipi { font-family: 'ome_swarlipi'; }

.meend-wrapper {
  display: inline-flex;   /* Use flex for tighter, baseline-aligned layout */
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 1.7em;          /* Forces a consistent block for meend+note */
  vertical-align: middle;
  white-space: nowrap;    /* Prevents line break between meend and its note */
  position: relative;
}

.meend-symbol {
  height: 12px;           /* Fixed, small size */
  width: auto;
  object-fit: contain;
  user-select: none;
  pointer-events: none;
  margin-bottom: 0.05em;  /* Slight separation from note */
}

.meend-note {
  display: block;         /* Now always under the image */
  font-size: 1em;
  line-height: 1.1;
  text-align: center;
}

  @media (max-width: 600px) {
  #editor {
    font-size: 1rem;
    line-height: 1.2;
  }
  .meend-symbol {
    height: 10px;
  }
  .meend-wrapper {
    height: 1.4em;
  }
}
  
  </style>

  <!-- Bhatkhande Web Font -->
  <link rel="stylesheet" href="https://webfonts.omenad.net/fonts.css">
</head>
<body>

  
<header class="site-header">
  <div class="nav-inner">
    <div class="brand-wrap">
      <a href="index.html" class="logo">
        <img src="LOGO.png" alt="SargamWorld Logo">
        <span>SargamWorld</span>
      </a>
      <span class="tagline">Explore • Learn • Practice</span>
    </div>

    <div class="hamburger">☰</div>

    <ul class="nav-links" id="navLinks">
      <li><a href="index.html">Home</a></li>
      <li><a href="songs.html">Songs</a></li>
      <li><a href="tools.html" class="active">Tools</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="support.html">Support</a></li>
    </ul>
  </div>
</header>



  
<main class="container">
  <section class="hero">
    <h1>Bhatkhande Notation Editor</h1>
    <p>Type your composition using the Bhatkhande keyboard below and download as PDF.</p>
  </section>

<small id="fontHint" style="color:gray; display:none;">
  Typing in <span id="currentFontName"></span> notation mode
</small>

  
<div style="text-align:center; margin:20px;">
  <button id="toggleNotation"
          style="padding:8px 14px; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer;">
    Notation Mode: OFF
  </button>

<select id="fontSelector" style="padding:8px; border-radius:6px; margin-left:10px;">

  <option value="">-- Select Font --</option>
  <option value="ome-bhatkhande-hindi">Bhatkhande Hindi</option>
  <option value="ome-bhatkhande-punjabi">Bhatkhande Punjabi</option>
  <option value="ome-bhatkhande-bangla">Bhatkhande Bangla</option>
  <option value="ome-bhatkhande-english">Bhatkhande English</option>
  <option value="ome-swarlipi">Ome Swarlipi</option>

</select>

</div>

  
  <div id="editor" contenteditable="true"></div>

  <div class="keyboard">
    <!-- Swars -->
    <div class="keyboard-section">
      <h4>Swars</h4>
      <button data-key="s">Sa (s)</button>
      <button data-key="r">Re (r)</button>
      <button data-key="R">Komal Re (R)</button>
      <button data-key="g">Ga (g)</button>
      <button data-key="G">Komal Ga (G)</button>
      <button data-key="m">Ma (m)</button>
      <button data-key="M">Teevra Ma (M)</button>
      <button data-key="p">Pa (p)</button>
      <button data-key="d">Dha (d)</button>
      <button data-key="D">Komal Dha (D)</button>
      <button data-key="n">Ni (n)</button>
      <button data-key="N">Komal Ni (N)</button>
    </div>

    <!-- Octaves -->
    <div class="keyboard-section">
      <h4>Octaves</h4>
      <button data-key="su">Taar Sa (su)</button>
      <button data-key="Nl">Mandra Komal Ni (Nl)</button>
      <button data-key="Mu">Taar Teevra Ma (Mu)</button>
    </div>

    <!-- Chhand -->
    <div class="keyboard-section">
      <h4>Chhand</h4>
      <button data-key="@">Dugun (2)</button>
      <button data-key="#">Tigun (3)</button>
      <button data-key="$">Chaugun (4)</button>
      <button data-key="%">Pachgun (5)</button>
      <button data-key="^">Chhatgun (6)</button>
      <button data-key="&">Satgun (7)</button>
      <button data-key="*">Athgun (8)</button>
      <button data-key="`">Lower Chaugun (4)</button>
      <button data-key="!">Lower Chhatgun (6)</button>
      <button data-key="~">Lower Athgun (8)</button>
    </div>

    <!-- Meend -->
    <div class="keyboard-section">
      <h4>Meend</h4>
      <button data-key="q">Start (q)</button>
      <button data-key="w">Continue (w)</button>
      <button data-key="e">End (e)</button>
      <button data-key="Q">Ghaseet Start (Q)</button>
      <button data-key="W">Stroke (W)</button>
      <button data-key="E">Ghaseet End (E)</button>
    </div>

    <!-- Murki -->
    <div class="keyboard-section">
      <h4>Murki</h4>
      <button data-key="(">( Start</button>
      <button data-key=")">) End</button>
    </div>

    <!-- Mizrab -->
    <div class="keyboard-section">
      <h4>Mizrab</h4>
      <button data-key=";">Da (;)</button>
      <button data-key="'">Ra (')</button>
      <button data-key="[">Daa ([)</button>
      <button data-key="]">Raa (])</button>
      <button data-key="\\">Dir (\)</button>
      <button data-key="-">Khali (-)</button>
    </div>

    <!-- Controls -->
    <div class="keyboard-section">
      <h4>Controls</h4>
      <button onclick="clearEditor()">Clear</button>
    </div>
  </div>

  <button id="downloadPDF" style="padding:10px 16px; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer; margin-top:10px;">
    Download PDF
  </button>
</main>

<footer class="site-footer">
  <small>© 2025 SargamWorld — All rights reserved. <a href="privacy.html">Privacy</a> · <a href="terms.html">Terms</a></small>
</footer>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const fontMap = {
  "ome_bhatkhande_hindi": "OmeBhatkhandeHindi.ttf",
  "ome_bhatkhande_punjabi": "OmeBhatkhandePunjabi.ttf",
  "ome_bhatkhande_bangla": "OmeBhatkhandeBangla.ttf",
  "ome_bhatkhande_english": "OmeBhatkhandeEnglish.ttf",
  "ome_swarlipi": "OmeSwarlipi.ttf"
};

// Map of meend characters to images
const meendMap = {
  "q": "meends/q.png",
  "w": "meends/w.png",
  "e": "meends/e.png",
  "Q": "meends/Q..png",
  "W": "meends/W..png",
  "E": "meends/E..png"
};

  
let notationMode = false;
let selectedFont = "";

const editor = document.getElementById("editor");
const fontSelector = document.getElementById("fontSelector");
const toggleBtn = document.getElementById("toggleNotation");

// Disable font selector initially
fontSelector.disabled = true;

// Toggle Notation Mode
toggleBtn.addEventListener("click", () => {
  notationMode = !notationMode;

  if (notationMode) {
    toggleBtn.innerText = "Notation Mode: ON";
    toggleBtn.style.background = "#228B22";
    fontSelector.disabled = false;
  } else {
    toggleBtn.innerText = "Notation Mode: OFF";
    toggleBtn.style.background = "var(--accent)";
    fontSelector.disabled = true;
  }
});

// Font change
fontSelector.addEventListener("change", () => {
  selectedFont = fontSelector.value;
  // Do NOT change editor.style.fontFamily here
});

// Insert text at caret (wrap only new notation in font)
function insertAtCaret(content) {
  editor.focus();
  const sel = window.getSelection();
  if (!sel.rangeCount) return;
  const range = sel.getRangeAt(0);

  // 1. If it's a meend, insert wrapper with image and empty note slot (inline, no <br>)
  if (meendMap[content]) {
    let wrapper = document.createElement("span");
    wrapper.className = "meend-wrapper";

    // Meend image
    const img = document.createElement("img");
    img.src = meendMap[content];
    img.alt = content;
    img.className = "meend-symbol";
    img.setAttribute('data-symbol', content);

    // The note span (empty for now)
    const noteSpan = document.createElement("span");
    noteSpan.className = "meend-note";
    noteSpan.innerHTML = "&nbsp;"; // visually keep height

    // Arrange: image above, note below (no <br>)
    wrapper.appendChild(img);
    wrapper.appendChild(noteSpan);

    // Insert wrapper at caret
    range.deleteContents();
    range.insertNode(wrapper);

    // Move caret inside the empty note span
    sel.removeAllRanges();
    const newRange = document.createRange();
    newRange.selectNodeContents(noteSpan);
    newRange.collapse(true);
    sel.addRange(newRange);
    return;
  }

  // 2. If the caret is inside a .meend-note, fill it with the note
  let node = null;
  if (
    sel.anchorNode && 
    sel.anchorNode.parentElement && 
    sel.anchorNode.parentElement.classList.contains("meend-note")
  ) {
    let noteSpan = sel.anchorNode.parentElement;
    if (notationMode && selectedFont) {
      node = document.createElement("span");
      node.className = selectedFont;
      node.textContent = content;
      noteSpan.innerHTML = ""; // clear
      noteSpan.appendChild(node);
    } else {
      noteSpan.textContent = content;
    }
    // Move caret after the whole meend-wrapper (no zero-width space needed)
    let wrapper = noteSpan.closest('.meend-wrapper');
    if (wrapper) {
      sel.removeAllRanges();
      let newRange = document.createRange();
      newRange.setStartAfter(wrapper);
      newRange.collapse(true);
      sel.addRange(newRange);
    }
    return;
  }

  // 3. Otherwise, insert as normal
  if (notationMode && selectedFont) {
    node = document.createElement("span");
    node.className = selectedFont;
    node.textContent = content;
  } else {
    node = document.createTextNode(content);
  }

  range.deleteContents();
  range.insertNode(node);
  // Move caret after
  range.setStartAfter(node);
  range.collapse(true);
  sel.removeAllRanges();
  sel.addRange(range);
}

  
// Virtual keyboard buttons
const buttons = document.querySelectorAll(".keyboard button[data-key]");
buttons.forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    editor.focus();
    const key = btn.getAttribute("data-key");
    insertAtCaret(key);
  });
});

// Normal typing in notation mode
editor.addEventListener("keydown", (e) => {
  if (notationMode && selectedFont && e.key.length === 1) {
    e.preventDefault();
    insertAtCaret(e.key);
  }
});

// Clear editor
function clearEditor() {
  editor.innerHTML = "";
}

//PDF
document.getElementById("downloadPDF").addEventListener("click", async () => {
  const editorElement = document.getElementById("editor");

  // Wait for all fonts to load
  await document.fonts.ready;

  // Use html2canvas to capture the editor
  const canvas = await html2canvas(editorElement, {
    scale: 3,               // high-res image
    backgroundColor: "#ffffff",
    useCORS: true,
    letterRendering: true,
    scrollY: -window.scrollY, // capture full content
  });

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "pt", "a4");

  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();
  const margin = 20;

  const imgWidth = pdfWidth - 2 * margin;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  let remainingHeight = canvas.height;
  let sourceY = 0;

  while (remainingHeight > 0) {
    // Calculate height for this page
    const pageCanvasHeight = Math.min(remainingHeight, (canvas.height * (pdfHeight - 2 * margin)) / imgHeight);

    // Temporary canvas for this page
    const pageCanvas = document.createElement("canvas");
    pageCanvas.width = canvas.width;
    pageCanvas.height = pageCanvasHeight;
    const ctx = pageCanvas.getContext("2d");

    // Draw portion of original canvas
    ctx.drawImage(
      canvas,
      0, sourceY, canvas.width, pageCanvasHeight,
      0, 0, canvas.width, pageCanvasHeight
    );

    // Add page image to PDF
    const pageImgData = pageCanvas.toDataURL("image/png");
    pdf.addImage(pageImgData, "PNG", margin, margin, imgWidth, (pageCanvasHeight * imgWidth) / canvas.width);

    remainingHeight -= pageCanvasHeight;
    sourceY += pageCanvasHeight;

    if (remainingHeight > 0) pdf.addPage();
  }

  pdf.save("Composition.pdf");
});



// Utility: ArrayBuffer → Base64
function arrayBufferToBase64(buffer) {
  let binary = '';
  const bytes = new Uint8Array(buffer);
  const chunkSize = 0x8000;
  for (let i = 0; i < bytes.length; i += chunkSize) {
    let chunk = bytes.subarray(i, i + chunkSize);
    binary += String.fromCharCode.apply(null, chunk);
  }
  return window.btoa(binary);
}
// JS for Hamburger
document.addEventListener("DOMContentLoaded", () => {
  const hamburger = document.querySelector(".hamburger");
  const navLinks = document.getElementById("navLinks");

  hamburger.addEventListener("click", () => {
    navLinks.classList.toggle("show");
  });
});

</script>
  
<script src="https://cdn.commoninja.com/sdk/latest/commonninja.js" defer></script>
<div class="commonninja_component pid-bf197859-7990-487e-9ccf-7f7f2052ecc0"></div>
  
</body>
</html>

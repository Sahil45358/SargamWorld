<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bhatkhande Notation — SargamWorld</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <style>
    /* === THEME VARIABLES === */
    :root {
      --accent: #800000;      /* red theme */
      --bg: #f3eee8;
      --text: #222;
      --muted: #5a5a5a;
      --radius: 12px;
      --container-w: 1100px;
      --transition: 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      line-height: 1.6;
    }

    a { text-decoration: none; color: inherit; }

    /* === NAVBAR === */
    .site-header {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
      z-index: 1000;
    }

    .nav-inner {
      max-width: var(--container-w);
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between; /* logo left, links right */
      gap: 12px;
      padding: 12px 20px;
      flex-wrap: wrap; /* allows wrapping on smaller screens */
    }

    .brand-wrap {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      flex-shrink: 0; /* prevent shrinking on PC */
    }

    .logo { display: flex; align-items: center; gap: 8px; font-weight:700; font-size:1.2rem; color:#fff; }
    .logo img { height: 120px; }

    .tagline {
      font-size: 0.8rem;
      font-weight: 400;
      color: #f3e8e8;
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .nav-links {
      display: flex;
      gap: 10px;
      list-style: none;
      margin-left: auto; /* push links to the right */
    }

    .nav-links a {
      color:#fff; padding:8px 12px; border-radius:8px; font-weight:600; transition: var(--transition);
    }
    .nav-links a:hover, .nav-links a:focus { background: rgba(255,255,255,0.1); }
    .nav-links a.active { background: rgba(255,255,255,0.15); }

    .hamburger {
      display: none;
      cursor: pointer;
      font-size: 1.6rem;
      color: #fff;
    }

    @media (pointer: coarse) {
      .logo span { display: none !important; }
    }
    @media (max-width: 1024px) {
      .logo span { display: none !important; }
    }
    @media (max-width: 768px) {
      .nav-links {
        display: none;
        flex-direction: column;
        background: var(--accent);
        position: absolute;
        top: 100px; right: 20px;
        padding: 15px;
        border-radius: 8px;
      }
      .nav-links.show { display: flex; }
      .hamburger { display: block; position: relative; z-index: 1100; }
      .tagline { font-size: 0.7rem; }
      .nav-links { margin-left: 0; }
    }

    /* === HERO === */
    .hero { text-align: center; margin-bottom: 30px; }
    .hero h1 { font-size: 2rem; color: var(--accent); margin-bottom: 10px; }
    .hero p { max-width: 720px; margin: 0 auto; color: var(--muted); line-height: 1.6; }


    
  /* Editor adjustments */
#editor {
  width: 80%;
  max-width: 720px;   /* ✅ limit maximum width on PC */
  min-width: 300px;   /* ✅ minimum width so it doesn't shrink too small on mobile */
  margin: 0 auto 20px auto; /* center the editor */
  min-height: 200px;  /* slightly smaller height */
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: var(--radius);
  padding: 12px;
  font-size: 1.2rem;  /* slightly smaller text for better fit */
  background: #fff;
  font-family: 'Segoe UI', sans-serif; /* default typing */
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow: auto;
  margin: 0 auto 20px;  /* center editor horizontally */
  scroll-behavior: smooth;
  direction: ltr;
  text-align: left;
}


/* Optional: even smaller on very small screens */
@media (max-width: 480px) {
  #editor {
    font-size: 1rem;
    min-height: 150px;
  }
}
    /* === KEYBOARD BUTTONS === */
 .keyboard button {
  width: 60px;           /* same width */
  height: 40px;          /* same height */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2px;          /* smaller padding to fit text */
  font-size: 0.75rem;    /* smaller font for longer labels */
  text-align: center;
  line-height: 1.1;
  word-wrap: break-word; /* allow breaking text into multiple lines */
  background: #800000;
  color: #fff;
  border: none;
  border-radius: 6px;
  margin: 3px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.2s ease;
}


    .keyboard button:hover {
      background: #9b1717;
      color: #fff;
    }
@media(min-width: 1025px) {
  .keyboard button {
    width: 70px;
    height: 45px;
    font-size: 0.8rem;
  }
}
    .keyboard-section button {
      background: #800000;
      color: #fff;
    }
    .keyboard-section button:hover {
      background: #9b1717;
    }

/* === Keyboard container & sections === */
.keyboard {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;               
  justify-content: center;  
  margin: 20px auto;       
}

.keyboard-section {
  border: 1px solid rgba(0,0,0,0.1);
  border-radius: var(--radius);
  padding: 10px;
  background: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;   
  min-width: 180px;          
}

@media (max-width: 768px) {
  .keyboard-section {
    min-width: 140px;
    padding: 8px;
  }

  .keyboard button {
    padding: 6px 10px;
    font-size: 0.9rem;
  }
}
@media (max-width: 768px) {
  .keyboard button {
    width: 45px;
    height: 35px;
    font-size: 0.65rem;
  }
}
  
    /* Footer */
    .site-footer {
      text-align: center;
      padding: 20px;
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 40px;
      background: none;
    }
  
.notation-active {
  border: 2px solid var(--accent);
  background: #fffbe7;
}

  #fontSelector:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

    @font-face {
  font-family: 'OmeBhatkhandeHindi';
  src: url('fonts/OmeBhatkhandeHindi.ttf') format('truetype');
}
@font-face {
  font-family: 'OmeBhatkhandePunjabi';
  src: url('fonts/OmeBhatkhandePunjabi.ttf') format('truetype');
}
@font-face {
  font-family: 'OmeBhatkhandeBangla';
  src: url('fonts/OmeBhatkhandeBangla.ttf') format('truetype');
}
@font-face {
  font-family: 'OmeBhatkhandeEnglish';
  src: url('fonts/OmeBhatkhandeEnglish.ttf') format('truetype');
}
@font-face {
  font-family: 'OmeSwarlipi';
  src: url('fonts/OmeSwarlipi.ttf') format('truetype');
}

   /* Greyed-out dropdown */
  select:disabled {
    background-color: #e0e0e0;
    color: #888;
    cursor: not-allowed;
  }

#editor {
  font-family: 'Segoe UI', sans-serif;
}

#editor {
  width: 80%;
  max-width: 720px;
  min-width: 300px;
  margin: 0 auto 20px auto;
  min-height: 200px;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: var(--radius);
  padding: 12px;
  font-size: 1.2rem;
  background: #fff;
  font-family: 'Segoe UI', sans-serif; /* default for plain typing */
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow: auto;
  scroll-behavior: smooth;
  direction: ltr;
  text-align: left;
}

#editor .ome-bhatkhande-hindi { font-family: 'OmeBhatkhandeHindi' !important; }
#editor .ome-bhatkhande-punjabi { font-family: 'OmeBhatkhandePunjabi' !important; }
#editor .ome-bhatkhande-bangla { font-family: 'OmeBhatkhandeBangla' !important; }
#editor .ome-bhatkhande-english { font-family: 'OmeBhatkhandeEnglish' !important; }
#editor .ome-swarlipi { font-family: 'OmeSwarlipi' !important; }

</head>
<body>
<header class="site-header">
  <div class="nav-inner">
    <div class="brand-wrap">
      <a href="index.html" class="logo">
        <img src="LOGO.png" alt="SargamWorld Logo">
        <span>SargamWorld</span>
      </a>
      <span class="tagline">Explore • Learn • Practice</span>
    </div>
    <ul class="nav-links" id="navLinks">
      <li><a href="index.html">Home</a></li>
      <li><a href="songs.html">Songs</a></li>
      <li><a href="tools.html" class="active">Tools</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="support.html">Support</a></li>
    </ul>
  </div>
</header>

<main class="container">
  <section class="hero">
    <h1>Bhatkhande Notation Editor</h1>
    <p>Type your composition using the Bhatkhande keyboard below and download as PDF.</p>
  </section>
  <div style="text-align:center; margin:20px;">
    <button id="toggleNotation"
      style="padding:8px 14px; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer;">
      Notation Mode: OFF
    </button>
    <select id="fontSelector" style="padding:8px; border-radius:6px; margin-left:10px;">
      <option value="">-- Select Font --</option>
      <option value="ome-bhatkhande-hindi">Bhatkhande Hindi</option>
      <option value="ome-bhatkhande-punjabi">Bhatkhande Punjabi</option>
      <option value="ome-bhatkhande-bangla">Bhatkhande Bangla</option>
      <option value="ome-bhatkhande-english">Bhatkhande English</option>
      <option value="ome-swarlipi">Ome Swarlipi</option>
    </select>
  </div>
  <div id="editor" contenteditable="true"></div>
  <div class="keyboard">
    <!-- Swars -->
    <div class="keyboard-section">
      <h4>Swars</h4>
      <button data-key="s">Sa (s)</button>
      <button data-key="r">Re (r)</button>
      <button data-key="R">Komal Re (R)</button>
      <button data-key="g">Ga (g)</button>
      <button data-key="G">Komal Ga (G)</button>
      <button data-key="m">Ma (m)</button>
      <button data-key="M">Teevra Ma (M)</button>
      <button data-key="p">Pa (p)</button>
      <button data-key="d">Dha (d)</button>
      <button data-key="D">Komal Dha (D)</button>
      <button data-key="n">Ni (n)</button>
      <button data-key="N">Komal Ni (N)</button>
    </div>
    <!-- Octaves -->
    <div class="keyboard-section">
      <h4>Octaves</h4>
      <button data-key="su">Taar Sa (su)</button>
      <button data-key="Nl">Mandra Komal Ni (Nl)</button>
      <button data-key="Mu">Taar Teevra Ma (Mu)</button>
    </div>
    <!-- Chhand -->
    <div class="keyboard-section">
      <h4>Chhand</h4>
      <button data-key="@">Dugun (2)</button>
      <button data-key="#">Tigun (3)</button>
      <button data-key="$">Chaugun (4)</button>
      <button data-key="%">Pachgun (5)</button>
      <button data-key="^">Chhatgun (6)</button>
      <button data-key="&">Satgun (7)</button>
      <button data-key="*">Athgun (8)</button>
      <button data-key="`">Lower Chaugun (4)</button>
      <button data-key="!">Lower Chhatgun (6)</button>
      <button data-key="~">Lower Athgun (8)</button>
    </div>
    <!-- Meend -->
    <div class="keyboard-section">
      <h4>Meend</h4>
      <button data-key="q">Start (q)</button>
      <button data-key="w">Continue (w)</button>
      <button data-key="e">End (e)</button>
      <button data-key="Q">Ghaseet Start (Q)</button>
      <button data-key="W">Stroke (W)</button>
      <button data-key="E">Ghaseet End (E)</button>
    </div>
    <!-- Murki -->
    <div class="keyboard-section">
      <h4>Murki</h4>
      <button data-key="(">( Start</button>
      <button data-key=")">) End</button>
    </div>
    <!-- Mizrab -->
    <div class="keyboard-section">
      <h4>Mizrab</h4>
      <button data-key=";">Da (;)</button>
      <button data-key="'">Ra (')</button>
      <button data-key="[">Daa ([)</button>
      <button data-key="]">Raa (])</button>
      <button data-key="\\">Dir (\)</button>
      <button data-key="-">Khali (-)</button>
    </div>
    <div class="keyboard-section">
      <h4>Controls</h4>
      <button onclick="clearEditor()">Clear</button>
    </div>
  </div>
  <button id="downloadPDF"
    style="padding:10px 16px; background:var(--accent); color:#fff; border:none; border-radius:var(--radius); font-weight:600; cursor:pointer; margin-top:10px;">
    Download PDF
  </button>
</main>
<footer class="site-footer">
  <small>© 2025 SargamWorld — All rights reserved.</small>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
<script>
const fontNames = {
  "ome_bhatkhande_hindi": "OmeBhatkhandeHindi",
  "ome_bhatkhande_punjabi": "OmeBhatkhandePunjabi",
  "ome_bhatkhande_bangla": "OmeBhatkhandeBangla",
  "ome_bhatkhande_english": "OmeBhatkhandeEnglish",
  "ome_swarlipi": "OmeSwarlipi"
};

// Base64 placeholder

let notationMode = false;
let selectedFont = "";

document.addEventListener("DOMContentLoaded", () => {
  const fontSelector = document.getElementById("fontSelector");
  const toggleBtn = document.getElementById("toggleNotation");
  const editor = document.getElementById("editor");

  // Disable font selector initially
  fontSelector.disabled = true;

  // Toggle Notation Mode
  toggleBtn.addEventListener("click", () => {
    notationMode = !notationMode;
    if (notationMode) {
      toggleBtn.innerText = "Notation Mode: ON";
      toggleBtn.style.background = "#228B22";
      fontSelector.disabled = false;
    } else {
      toggleBtn.innerText = "Notation Mode: OFF";
      toggleBtn.style.background = "var(--accent)";
      fontSelector.disabled = true;
      fontSelector.value = "";
      selectedFont = "";
    }
    editor.focus();
  });

  // Font change
  fontSelector.addEventListener("change", () => {
    selectedFont = fontSelector.value;
    editor.focus();
  });

  // INSERT TEXT AT CARET - FIXED FOR DESKTOP
  function insertAtCaret(content) {
    console.log("1. Function called. Notation Mode:", notationMode, "Selected Font:", selectedFont); // DEBUG
    editor.focus();

    const sel = window.getSelection();
    console.log("2. Selection rangeCount:", sel.rangeCount); // DEBUG

    if (sel.rangeCount === 0) {
        console.log("3a. No selection found. Appending content."); // DEBUG
        appendContent(content);
        return;
    }

    const range = sel.getRangeAt(0);
    console.log("3b. Range found. commonAncestorContainer:", range.commonAncestorContainer); // DEBUG

    // Check if the selection is within the editor
    if (!editor.contains(range.commonAncestorContainer)) {
        console.log("4. Selection is NOT inside editor. Appending content."); // DEBUG
        appendContent(content);
        return;
    }
    console.log("5. Selection is valid. Preparing to insert:", content); // DEBUG

    range.deleteContents();

    let node;
    if (notationMode && selectedFont) {
        node = document.createElement("span");
        node.className = selectedFont;
        node.textContent = content;
        console.log("6. Creating SPAN with class:", selectedFont); // DEBUG
    } else {
        node = document.createTextNode(content);
        console.log("6. Creating TEXT node"); // DEBUG
    }

    range.insertNode(node);
    console.log("7. Node inserted into DOM."); // DEBUG

    // Move the cursor to after the inserted node
    const newRange = document.createRange();
    newRange.setStartAfter(node);
    newRange.collapse(true);

    sel.removeAllRanges();
    sel.addRange(newRange);
    editor.focus();
    console.log("8. Cursor moved and focus set. Operation complete.\n---"); // DEBUG
  }
   // Helper function to append content if selection is lost - FIXED VERSION
  function appendContent(content) {
    let node;
    if (notationMode && selectedFont) {
        node = document.createElement("span");
        node.className = selectedFont;
        node.textContent = content;
    } else {
        node = document.createTextNode(content);
    }
    editor.appendChild(node);

    // Move cursor to end after appending - FIXED LOGIC
    const sel = window.getSelection();
    const newRange = document.createRange();
    
    // Set the range to the end of the newly inserted node
    newRange.setStartAfter(node);
    newRange.collapse(true); // Collapse to the start of the range (which is now after the node)

    sel.removeAllRanges();
    sel.addRange(newRange);
  }

  // Attach virtual keyboard buttons (once) - IMPROVED VERSION
  const buttons = document.querySelectorAll(".keyboard button[data-key]");
  buttons.forEach(btn => {
    // Listener for mouse/trackpad
    btn.addEventListener("mousedown", (e) => {
      e.preventDefault(); // prevent losing focus
      const key = btn.getAttribute("data-key");
      insertAtCaret(key);
    });
    // Listener for touch/accessibility/fallback
    btn.addEventListener("click", (e) => {
      e.preventDefault(); 
      // insertAtCaret is already called by mousedown, 
      // so this is just a safety net. No need to call it again.
    });
  });


  // Clear editor
  window.clearEditor = function() {
    editor.innerHTML = "";
    editor.focus();
  };

   // PDF Download - FIXED VERSION
  document.getElementById("downloadPDF").addEventListener("click", () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "pt", format: "a4" });

    // 1. Register all notation fonts with jsPDF
    for (const key in fontBase64s) {
      const fontName = fontNames[key]; // e.g., "OmeBhatkhandeHindi"
      doc.addFileToVFS(`${fontName}.ttf`, fontBase64s[key]);
      doc.addFont(`${fontName}.ttf`, fontName, "normal");
    }

    let y = 60; // Starting Y position
    const lineHeight = 28; // Space between lines
    const margin = 60; // Left margin

    // 2. Get the editor's content and split it into lines
    // We use innerHTML to preserve the <span> elements, then create a temporary div to parse it
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = editor.innerHTML;

    // Handle lines: split by <br> and also consider block-level elements
    const lines = [];
    let currentLine = [];

    // Function to process a node and add its content to the current line
    function processNode(node) {
      if (node.nodeType === Node.TEXT_NODE) {
        // Split text node by newline characters
        const textLines = node.textContent.split('\n');
        if (textLines.length > 1) {
          // If there are newlines, add the first part to the current line
          currentLine.push({ text: textLines[0], font: 'helvetica' }); // Default font for plain text
          // Push the current line and start new lines for the other parts
          lines.push([...currentLine]);
          currentLine = [];

          for (let i = 1; i < textLines.length; i++) {
            if (textLines[i] !== '') {
              currentLine.push({ text: textLines[i], font: 'helvetica' });
            }
            // If it's not the last segment, push the line and reset
            if (i < textLines.length - 1) {
              lines.push([...currentLine]);
              currentLine = [];
            }
          }
        } else {
          // No newlines, just add the text
          if (node.textContent !== '') {
            currentLine.push({ text: node.textContent, font: 'helvetica' });
          }
        }
      } else if (node.nodeType === Node.ELEMENT_NODE) {
        if (node.tagName === 'BR') {
          // <br> tag means end of the current line
          lines.push([...currentLine]);
          currentLine = [];
        } else {
          // It's an element (like a SPAN with a font class)
          let fontFamily = 'helvetica'; // Default PDF font

          // Check the element's class to determine the font
          if (node.classList.contains('ome-bhatkhande-hindi')) {
            fontFamily = fontNames['ome_bhatkhande_hindi'];
          } else if (node.classList.contains('ome-bhatkhande-punjabi')) {
            fontFamily = fontNames['ome_bhatkhande_punjabi'];
          } else if (node.classList.contains('ome-bhatkhande-bangla')) {
            fontFamily = fontNames['ome_bhatkhande_bangla'];
          } else if (node.classList.contains('ome-bhatkhande-english')) {
            fontFamily = fontNames['ome_bhatkhande_english'];
          } else if (node.classList.contains('ome-swarlipi')) {
            fontFamily = fontNames['ome_swarlipi'];
          }
          // Process the text inside the element, applying the correct font
          const textLines = node.textContent.split('\n');
          if (textLines.length > 1) {
            currentLine.push({ text: textLines[0], font: fontFamily });
            lines.push([...currentLine]);
            currentLine = [];
            for (let i = 1; i < textLines.length; i++) {
              if (textLines[i] !== '') {
                currentLine.push({ text: textLines[i], font: fontFamily });
              }
              if (i < textLines.length - 1) {
                lines.push([...currentLine]);
                currentLine = [];
              }
            }
          } else {
            if (node.textContent !== '') {
              currentLine.push({ text: node.textContent, font: fontFamily });
            }
          }
        }
      }
    }

    // Process all child nodes of the temporary div
    for (let i = 0; i < tempDiv.childNodes.length; i++) {
      processNode(tempDiv.childNodes[i]);
    }
    // Push any remaining content in the currentLine after looping
    if (currentLine.length > 0) {
      lines.push([...currentLine]);
    }

    // 3. Draw each line to the PDF
    lines.forEach((lineContent) => {
      let x = margin; // Start at the left margin for each new line

      lineContent.forEach((textPart) => {
        doc.setFont(textPart.font, "normal");
        doc.setFontSize(14);
        doc.text(textPart.text, x, y, { baseline: "top" });
        // Move the X position for the next part on the same line
        x += doc.getTextWidth(textPart.text);
      });

      // Move the Y position down for the next line
      y += lineHeight;
      // Simple page break - start a new page if we reach the bottom
      if (y > doc.internal.pageSize.height - margin) {
        doc.addPage();
        y = margin;
      }
    });

    // 4. Save the PDF
    doc.save("Bhatkhande_Notation.pdf");
  });

  // Hamburger menu
  const hamburger = document.querySelector(".hamburger");
  const navLinks = document.getElementById("navLinks");
  if (hamburger) {
    hamburger.addEventListener("click", () => {
      navLinks.classList.toggle("show");
    });
  }
});
</script>

  
  <script src="https://cdn.commoninja.com/sdk/latest/commonninja.js" defer></script>
<div class="commonninja_component pid-bf197859-7990-487e-9ccf-7f7f2052ecc0"></div>
  

</body>
</html>


